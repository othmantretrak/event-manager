<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Event Manager - Book Events</title>
    <link rel="stylesheet" href="/css/main.css" />
  </head>
  <body>
    <div class="container">
      <div class="header attendee">
        <h1>Event Manager</h1>
        <p>Book Your Next Experience</p>
      </div>

      <div class="nav-links">
        <a href="/organiser" class="attendee">Organiser Dashboard</a>
      </div>

      <script>
        // Check for success/error messages in URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const success = urlParams.get("success");
        const error = urlParams.get("error");

        if (success) {
          document.addEventListener("DOMContentLoaded", function () {
            const alertDiv = document.createElement("div");
            alertDiv.className = "alert alert-success";
            alertDiv.textContent = success;
            document
              .querySelector(".container")
              .insertBefore(
                alertDiv,
                document.querySelector(".events-section")
              );
          });
        }

        if (error) {
          document.addEventListener("DOMContentLoaded", function () {
            const alertDiv = document.createElement("div");
            alertDiv.className = "alert alert-error";
            alertDiv.textContent = error;
            document
              .querySelector(".container")
              .insertBefore(
                alertDiv,
                document.querySelector(".events-section")
              );
          });
        }
      </script>

      <div class="events-section">
        <h2 class="attendee">Available Events</h2>

        <% if (events.length === 0) { %>
        <div class="no-events attendee">
          <h3>No Events Available</h3>
          <p>There are currently no upcoming events available for booking.</p>
          <p>Check back later or contact the organiser for more information.</p>
        </div>
        <% } else { %>
        <div class="events-grid">
          <% events.forEach(event => { %>
          <div class="event-card attendee">
            <div class="event-header attendee">
              <div class="event-title"><%= event.title %></div>
              <% if (event.description) { %>
              <div class="event-description"><%= event.description %></div>
              <% } %>
            </div>

            <div class="event-info">
              <div class="info-item attendee">
                <span class="info-label attendee">üìÖ Date:</span>
                <span
                  ><%= new Date(event.date).toLocaleDateString('en-US', {
                  weekday: 'long', year: 'numeric', month: 'long', day:
                  'numeric' }) %></span
                >
              </div>
              <div class="info-item attendee">
                <span class="info-label attendee">üïí Time:</span>
                <span
                  ><%= new Date('2000-01-01T' +
                  event.time).toLocaleTimeString('en-US', { hour: 'numeric',
                  minute: '2-digit', hour12: true }) %></span
                >
              </div>
              <div class="info-item attendee">
                <span class="info-label attendee">üìç Location:</span>
                <span><%= event.location %></span>
              </div>
            </div>

            <div class="event-capacity">
              <div class="capacity-info">
                <strong
                  >Available Spots: <%= event.max_attendees -
                  event.current_attendees %>/<%= event.max_attendees %></strong
                >
              </div>
              <div class="spots-remaining">
                <%= event.current_attendees %> people already booked
              </div>
            </div>

            <div class="booking-section">
              <h4 style="margin-bottom: 1rem; color: #28a745">
                Book This Event
              </h4>
              <form
                action="/attendee/book/<%= event.id %>"
                method="POST"
                class="booking-form attendee-form"
              >
                <div class="form-group">
                  <label for="name_<%= event.id %>">Your Name:</label>
                  <input
                    type="text"
                    id="name_<%= event.id %>"
                    name="attendee_name"
                    required
                  />
                </div>

                <div class="form-group">
                  <label for="email_<%= event.id %>">Your Email:</label>
                  <input
                    type="email"
                    id="email_<%= event.id %>"
                    name="attendee_email"
                    required
                  />
                </div>

                <button type="submit" class="btn attendee">Book Now</button>
              </form>
            </div>
          </div>
          <% }); %>
        </div>
        <% } %>
      </div>
    </div>
  </body>
</html>
